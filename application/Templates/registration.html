<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Create Account | JobMatch</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
  <style>
    :root{
      --brand:#4f46e5; --brand2:#7c3aed;
      --card-bg: rgba(255,255,255,.92);
      --shadow: 0 20px 40px rgba(0,0,0,.15);
      --radius: 18px; --muted:#4b5563;
      --danger:#dc2626; --ok:#10b981; --warn:#f59e0b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:#111827; background:#f3f4f6; display:flex; flex-direction:column; overflow:auto;
    }
    .nav{
      height:64px; display:flex; align-items:center; justify-content:flex-start;
      padding:0 24px; z-index:2;
      background:rgba(255,255,255,.75); backdrop-filter:saturate(160%) blur(8px);
      border-bottom:1px solid rgba(0,0,0,.06);
    }
    .brand{display:flex; align-items:center; gap:10px; font-weight:600; text-decoration:none; color:inherit}
    .brand img{height:28px}

    .hero{
      position:relative; flex:1; display:flex; align-items:center; justify-content:center;
      overflow:hidden; padding:48px 16px;
    }
    .hero::before{
      content:""; position:absolute; inset:0;
      background:url("{{ url_for('static', filename='img/auth_bg.jpg') }}") center/cover no-repeat fixed;
      transform:scale(1.02);
    }
    .hero::after{
      content:""; position:absolute; inset:0;
      background:linear-gradient(180deg, rgba(255,255,255,.25) 0%, rgba(17,24,39,.55) 100%);
    }

    .card{
      position:relative; z-index:1; width:min(520px, 92vw);
      background:var(--card-bg); border-radius:var(--radius);
      box-shadow:var(--shadow); padding:26px 26px 22px; margin:0 auto;
    }
    @media (min-width:640px){ .card{padding:32px 36px;} }

    .card-header{display:flex; flex-direction:column; align-items:center; gap:8px; margin-bottom:14px}
    .title{font-size:clamp(22px, 2.2vw, 28px); font-weight:800}
    .subtitle{font-size:14px; color:var(--muted)}

    label{display:block; font-size:14px; color:#374151; margin:10px 0 6px}
    input[type="text"], input[type="email"], input[type="password"]{
      width:100%; height:44px; border:1px solid #d1d5db; border-radius:10px;
      padding:0 44px 0 40px; font-size:14px; background:#fff;
      outline:none; transition:border .15s, box-shadow .15s;
    }
    input:focus{border-color:#6366f1; box-shadow:0 0 0 3px rgba(99,102,241,.15)}
    .field{position:relative}
    .icon{position:absolute; left:12px; top:50%; transform:translateY(-50%); color:#6b7280}
    .toggle{position:absolute; right:10px; top:50%; transform:translateY(-50%); color:#6b7280; background:transparent; border:0; cursor:pointer}

    .role-wrap{display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:8px}
    .role{border:1.5px solid #e5e7eb; border-radius:12px; padding:12px; cursor:pointer; background:#fff}
    .role.active{border-color:#6366f1; box-shadow:0 0 0 3px rgba(99,102,241,.15)}
    .role h4{margin:0; font-size:14px; font-weight:700}
    .role p{margin:6px 0 0; font-size:12px; color:var(--muted)}

    .meter{height:6px; width:100%; background:#e5e7eb; border-radius:999px; overflow:hidden}
    .meter > div{height:100%; width:20%; background:#ef4444; transition:width .25s ease, background .25s ease}

    .helper{font-size:12px; color:#6b7280; margin-top:6px}
    .error{
      display:none; font-size:12px; color:var(--danger); margin-top:6px;
    }

    .cta{
      width:100%; height:46px; border:0; border-radius:10px; cursor:pointer; color:#fff; font-weight:600; font-size:15px;
      background:linear-gradient(90deg, var(--brand), var(--brand2));
      box-shadow:0 8px 20px rgba(99,102,241,.25);
      transition:transform .06s ease; opacity:1;
    }
    .cta[disabled]{opacity:.6; cursor:not-allowed}

    .footer-link{margin-top:12px; text-align:center; font-size:14px; color:#4b5563}
    .footer-link a{color:#4f46e5; text-decoration:none}
    .footer-link a:hover{text-decoration:underline}

    .flash{padding:10px 12px; border-radius:10px; font-size:14px; margin-bottom:12px}
    .success{background:#ecfdf5; color:#065f46; border:1px solid #a7f3d0}
    .danger{background:#fef2f2; color:#991b1b; border:1px solid #fecaca}
    .warning{background:#fffbeb; color:#92400e; border:1px solid #fde68a}
    .info{background:#eff6ff; color:#1e40af; border:1px solid #bfdbfe}
  </style>
</head>
<body>
  <div class="nav">
    <a href="#" class="brand" onclick="location.reload(); return false;">
      <img src="{{ url_for('static', filename='img/logo_job.png') }}" alt="JobMatch">
      <span>JobMatch</span>
    </a>
  </div>

  <section class="hero">
    <div class="card">
      <div class="card-header">
        <div class="title">Join JobMatch</div>
        <div class="subtitle">Create your account in just a few steps</div>
      </div>

      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="flash {{ 'success' if category=='success' else 'warning' if category=='warning' else 'info' if category=='info' else 'danger' }}">{{ message }}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      <form method="POST" novalidate>
        {{ form.hidden_tag() }}

        <!-- Full Name -->
        <label>Full Name</label>
        <div class="field">
          <i class="fa-regular fa-user icon"></i>
          {{ form.name(placeholder="Enter your full name", autocomplete="name", id="full_name") }}
        </div>
        <div id="err_name" class="error" aria-live="polite">Full name must be at least 3 characters.</div>

        <!-- Email -->
        <label style="margin-top:12px;">Email Address</label>
        <div class="field">
          <i class="fa-regular fa-envelope icon"></i>
          {{ form.email(placeholder="your@email.com", autocomplete="email", id="email") }}
        </div>
        <div id="err_email" class="error" aria-live="polite">Please enter a valid email address.</div>

        <!-- Password -->
        <label style="margin-top:12px;">Password</label>
        <div class="field">
          <i class="fa-solid fa-lock icon"></i>
          {{ form.password(placeholder="Create a strong password", autocomplete="new-password", id="password") }}
          <button type="button" class="toggle" aria-label="Show password" onclick="togglePw()">
            <i id="pwIcon" class="fa-regular fa-eye"></i>
          </button>
        </div>
        <div class="meter" style="margin-top:8px;"><div id="meterBar"></div></div>
        <div class="helper">Use at least 6 characters. Stronger if 8+ with A-Z, a-z, 0-9, and a symbol.</div>
        <div id="err_password" class="error" aria-live="polite">Password must be at least 6 characters.</div>

        <!-- Role -->
        {{ form.role(type="hidden", id="role") }}
        <label style="margin-top:14px;">I want to join as:</label>
        <div class="role-wrap" id="roleWrap">
          <div class="role" data-role="company" tabindex="0" aria-label="Employer">
            <h4><i class="fa-solid fa-building" style="margin-right:6px;"></i> Employer</h4>
            <p>Post jobs and find candidates</p>
          </div>
          <div class="role" data-role="seeker" tabindex="0" aria-label="Job Seeker">
            <h4><i class="fa-solid fa-user-tie" style="margin-right:6px;"></i> Job Seeker</h4>
            <p>Find jobs and grow your career</p>
          </div>
        </div>
        <div id="err_role" class="error" aria-live="polite">Please select Employer or Job Seeker.</div>

        <div style="height: 12px;"></div>
        <button id="submitBtn" type="submit" class="cta" disabled>Create Account</button>
      </form>

      <div class="footer-link">
        Already have an account? <a href="{{ url_for('login') }}">Sign in</a>
      </div>
    </div>
  </section>

  <script>
    // --- Password toggle ---
    function togglePw(){
      const input = document.getElementById('password');
      const icon  = document.getElementById('pwIcon');
      if(!input || !icon) return;
      if(input.type === 'password'){ input.type = 'text';  icon.classList.replace('fa-eye','fa-eye-slash'); }
      else{                        input.type = 'password'; icon.classList.replace('fa-eye-slash','fa-eye'); }
    }

    // --- Password strength meter ---
    (function initPwMeter(){
      const pw  = document.getElementById('password');
      const bar = document.getElementById('meterBar');
      if(!pw || !bar) return;

      function score(s){
        let n = 0;
        if(s.length >= 8) n++;
        if(/[A-Z]/.test(s)) n++;
        if(/[a-z]/.test(s)) n++;
        if(/[0-9]/.test(s)) n++;
        if(/[^A-Za-z0-9]/.test(s)) n++;
        return n;
      }
      pw.addEventListener('input', ()=>{
        const s   = score(pw.value);
        const pct = [20,40,60,80,100][Math.max(0, s-1)];
        bar.style.width = pct + '%';
        bar.style.background = s <= 2 ? '#ef4444' : (s === 3 ? '#f59e0b' : '#10b981');
      });
    })();

    (function initValidation(){
      const nameEl   = document.getElementById('full_name');
      const emailEl  = document.getElementById('email');
      const pwEl     = document.getElementById('password');
      const roleInput= document.getElementById('role');
      const roleCards= Array.from(document.querySelectorAll('.role'));
      const submit   = document.getElementById('submitBtn');

      const errName  = document.getElementById('err_name');
      const errEmail = document.getElementById('err_email');
      const errPw    = document.getElementById('err_password');
      const errRole  = document.getElementById('err_role');

      
      roleInput.value = '';
      roleCards.forEach(c => c.classList.remove('active'));

      // Helpers
      const show = el => { if(el) el.style.display = 'block'; };
      const hide = el => { if(el) el.style.display = 'none'; };

      const validName = v => v.trim().length >= 3;
      const validEmail = v => v.includes('@') && v.split('@')[0].length > 0 && v.split('@')[1]?.length > 0;
      const validPw = v => v.length >= 6;
      const validRole = () => !!roleInput.value;

      function validateName(){ validName(nameEl.value) ? hide(errName) : show(errName); gate(); }
      function validateEmail(){ validEmail(emailEl.value.toLowerCase()) ? hide(errEmail) : show(errEmail); gate(); }
      function validatePw(){ validPw(pwEl.value) ? hide(errPw) : show(errPw); gate(); }
      function validateRole(){ validRole() ? hide(errRole) : show(errRole); gate(); }

      function gate(){
        const ok = validName(nameEl.value) && validEmail(emailEl.value.toLowerCase()) && validPw(pwEl.value) && validRole();
        submit.disabled = !ok;
      }

      // Live validation
      nameEl.addEventListener('input', validateName);
      emailEl.addEventListener('input', validateEmail);
      pwEl.addEventListener('input', validatePw);

      // Role interactions
      function setRole(val){
        roleCards.forEach(c => c.classList.toggle('active', c.dataset.role === val));
        roleInput.value = val;
        validateRole();
      }
      roleCards.forEach(c=>{
        c.addEventListener('click', ()=> setRole(c.dataset.role));
        c.addEventListener('keydown', (e)=>{
          if(e.key === 'Enter' || e.code === 'Space'){ e.preventDefault(); setRole(c.dataset.role); }
        });
      });

      // On load, ensure errors hidden and button gated
      hide(errName); hide(errEmail); hide(errPw); hide(errRole);
      gate();

      // Prevent submit if somehow clicked while invalid (safety)
      document.querySelector('form[method="POST"]').addEventListener('submit', (e)=>{
        if(submit.disabled) e.preventDefault();
      });
    })();
  </script>
</body>
</html>
